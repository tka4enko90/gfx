!function(n){"use strict";if("undefined"!=typeof woocommerce_admin_meta_boxes&&"undefined"!=typeof wc_price_based_country_pro_order_metaboxes_param){var t={init:function(){n("#woocommerce-order-items").on("click","button.wcpbc-load-pricing-action",this.on_load_country_pricing)},block:function(){n("#woocommerce-order-items").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},refresh:function(e){n("#woocommerce-order-items").find(".inside").empty(),n("#woocommerce-order-items").find(".inside").append(e),n("#tiptip_holder").removeAttr("style"),n("#tiptip_arrow").removeAttr("style"),n(".tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),n("#woocommerce-order-items").unblock(),n(".woocommerce_order_items").stupidtable(),n(".woocommerce_order_items").on("aftertablesort",this.add_arrows)},add_arrows:function(e,o){var r=n(this).find("th"),t="asc"===o.direction?"&uarr;":"&darr;",i=o.column;r.find(".wc-arrow").remove(),r.eq(i).append('<span class="wc-arrow">'+t+"</span>")},on_load_country_pricing:function(){window.confirm(wc_price_based_country_pro_order_metaboxes_param.i18n_load_country_pricing_confirm)&&t.load_country_pricing()},load_country_pricing:function(o){var e={country:"",state:"",postcode:"",city:""};"shipping"===woocommerce_admin_meta_boxes.tax_based_on&&(e.country=n("#_shipping_country").val(),e.state=n("#_shipping_state").val(),e.postcode=n("#_shipping_postcode").val(),e.city=n("#_shipping_city").val()),"billing"!==woocommerce_admin_meta_boxes.tax_based_on&&e.country||(e.country=n("#_billing_country").val(),e.state=n("#_billing_state").val(),e.postcode=n("#_billing_postcode").val(),e.city=n("#_billing_city").val());var r={action:"wc_price_based_country_load_country_pricing",order_id:woocommerce_admin_meta_boxes.post_id,billing_country:n("#_billing_country").val(),shipping_country:n("#_shipping_country").val(),items:n("table.woocommerce_order_items :input[name], .wc-order-totals-items :input[name]").serialize(),tax_args:e,security:wc_price_based_country_pro_order_metaboxes_param.load_country_pricing_nonce};t.block(),n.ajax({url:wc_price_based_country_pro_order_metaboxes_param.ajax_url,data:r,type:"POST",success:function(e){t.refresh(e),"function"==typeof o&&o(e)}})}},o={state:"",init:function(){if(!(0<!n("button#wcpbc-load-pricing-action").length)){var e=n("form#post");e.on("submit",this.before_save_order),e.on("click","a.edit_address",this.change_state),n("input:submit",e).on("click keypress",function(){e.data("callerid",this.id)})}},change_state:function(){o.state="edit"},before_save_order:function(e){o.need_update()&&window.confirm("Price Based on Country: "+wc_price_based_country_pro_order_metaboxes_param.i18n_before_save_confirm)&&(e.preventDefault(),t.load_country_pricing(o.before_save_order_done))},need_update:function(){var e=o.get_order_zone_id();return"edit"===o.state&&e!==n("button#wcpbc-load-pricing-action").data("zone_id")&&0<n(".woocommerce_order_items tr.item").length},before_save_order_done:function(){var e=n("form#post");"publish"===e.data("callerid")?e.append('<input type="hidden" name="publish" value="1" />').trigger("submit"):e.append('<input type="hidden" name="save-post" value="1" />').trigger("submit")},get_order_zone_id:function(){var e=n("#_billing_country").val(),o=n("#_shipping_country").val()?n("#_shipping_country").val():e,r="billing"===wc_price_based_country_pro_order_metaboxes_param.price_based_on?e:o,t="";return wc_price_based_country_pro_order_metaboxes_param.zones_and_countries.forEach(function(e,o){-1===e.countries.indexOf(r)||(t=e.zone_id)}),t}};t.init(),o.init()}}(jQuery);