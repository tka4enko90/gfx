!function(i){"use strict";var r,o;"undefined"!=typeof woocommerce_admin_meta_boxes&&"undefined"!=typeof wc_price_based_country_pro_order_metaboxes_param&&(o={state:"",init:function(){var e;0<!i("button#wcpbc-load-pricing-action").length||((e=i("form#post")).on("submit",this.before_save_order),e.on("click","a.edit_address",this.change_state),i("input:submit",e).on("click keypress",function(){e.data("callerid",this.id)}))},change_state:function(){o.state="edit"},before_save_order:function(e){o.need_update()&&window.confirm("Price Based on Country: "+wc_price_based_country_pro_order_metaboxes_param.i18n_before_save_confirm)&&(e.preventDefault(),r.load_country_pricing(o.before_save_order_done))},need_update:function(){var e=o.get_order_zone_id();return"edit"===o.state&&e!==i("button#wcpbc-load-pricing-action").data("zone_id")&&0<i(".woocommerce_order_items tr.item").length},before_save_order_done:function(){var e=i("form#post");("publish"===e.data("callerid")?e.append('<input type="hidden" name="publish" value="1" />'):e.append('<input type="hidden" name="save-post" value="1" />')).trigger("submit")},get_order_zone_id:function(){var e=i("#_billing_country").val(),o=i("#_shipping_country").val()?i("#_shipping_country").val():e,r="billing"===wc_price_based_country_pro_order_metaboxes_param.price_based_on?e:o,t="";return wc_price_based_country_pro_order_metaboxes_param.zones_and_countries.forEach(function(e,o){-1!==e.countries.indexOf(r)&&(t=e.zone_id)}),t}},(r={init:function(){i("#woocommerce-order-items").on("click","button.wcpbc-load-pricing-action",this.on_load_country_pricing)},block:function(){i("#woocommerce-order-items").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},refresh:function(e){i("#woocommerce-order-items").find(".inside").empty(),i("#woocommerce-order-items").find(".inside").append(e),i("#tiptip_holder").removeAttr("style"),i("#tiptip_arrow").removeAttr("style"),i(".tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),i("#woocommerce-order-items").unblock(),i(".woocommerce_order_items").stupidtable(),i(".woocommerce_order_items").on("aftertablesort",this.add_arrows)},add_arrows:function(e,o){var r=i(this).find("th"),t="asc"===o.direction?"&uarr;":"&darr;",o=o.column;r.find(".wc-arrow").remove(),r.eq(o).append('<span class="wc-arrow">'+t+"</span>")},on_load_country_pricing:function(){window.confirm(wc_price_based_country_pro_order_metaboxes_param.i18n_load_country_pricing_confirm)&&r.load_country_pricing()},load_country_pricing:function(o){var e={country:"",state:"",postcode:"",city:""},e=("shipping"===woocommerce_admin_meta_boxes.tax_based_on&&(e.country=i("#_shipping_country").val(),e.state=i("#_shipping_state").val(),e.postcode=i("#_shipping_postcode").val(),e.city=i("#_shipping_city").val()),"billing"!==woocommerce_admin_meta_boxes.tax_based_on&&e.country||(e.country=i("#_billing_country").val(),e.state=i("#_billing_state").val(),e.postcode=i("#_billing_postcode").val(),e.city=i("#_billing_city").val()),{action:"wc_price_based_country_load_country_pricing",order_id:woocommerce_admin_meta_boxes.post_id,billing_country:i("#_billing_country").val(),shipping_country:i("#_shipping_country").val(),items:i("table.woocommerce_order_items :input[name], .wc-order-totals-items :input[name]").serialize(),tax_args:e,security:wc_price_based_country_pro_order_metaboxes_param.load_country_pricing_nonce});r.block(),i.ajax({url:wc_price_based_country_pro_order_metaboxes_param.ajax_url,data:e,type:"POST",success:function(e){r.refresh(e),"function"==typeof o&&o(e)}})}}).init(),o.init())}(jQuery);