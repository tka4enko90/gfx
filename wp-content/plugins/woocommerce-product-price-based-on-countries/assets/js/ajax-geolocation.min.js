!function(n){if("undefined"==typeof wc_price_based_country_ajax_geo_params)return;var s={xhr:!1,get_product_ids:function(){var a=[],r=null;return n("span.wcpbc-price.loading").each(function(){if(void 0===(r=n(this).data("productId"))){var e=n(this).attr("class").match(/wcpbc-price-\d+/);null!=e&&0<e.length&&(r=parseInt(e[0].replace("wcpbc-price-","")))}r&&void 0!==r&&a.push(r)}),0<n(".variations_form").length&&n(".variations_form").each(function(){var e=n(this).data("product_variations");null!=e&&n.each(e,function(e,r){void 0!==r.variation_id&&a.push(r.variation_id)})}),n(document.body).trigger("wc_price_based_country_get_product_ids",[a]),a.sort(),a},get_areas:function(){var t={};return n(".wc-price-based-country-refresh-area:not(.refreshed)").each(function(e,r){var a=n(r).data("area"),c=n(r).data("id"),i=n(r).data("options");void 0!==a&&void 0!==c&&void 0!==i&&(void 0===t[a]&&(t[a]={}),t[a][c]=i)}),t},refresh_product_price:function(o){var a;n.each(o,function(e,r){void 0!==(a=n("<div>"+r.price_html+"</div>").find(".wcpbc-price.wcpbc-price-"+r.id+":first"))&&n(".wcpbc-price.wcpbc-price-"+r.id).html(a.html()).removeClass("loading")}),0<n(".variations_form").length&&n(".variations_form").each(function(){var i=n(this).data("product_variations"),t=n(this);null!=i&&(n.each(i,function(e,r){if(void 0!==o[r.variation_id]){var a=n(r.price_html);if(i[e].display_price=o[r.variation_id].display_price,i[e].display_regular_price=o[r.variation_id].display_regular_price,0<a.length)if(a.hasClass("price")){var c=n("<div></div>").append(a);c.find(".price").html(o[r.variation_id].price_html),a=n(c.html())}else a=n(o[r.variation_id].price_html);else n("body").hasClass("single-product")||(a=s.compatibility.variation_price_html(a,t,o[r.variation_id].price_html));0<a.length&&(a.find(".wcpbc-price").css("visibility",""),a.find(".wcpbc-price").removeClass("loading"),a=n("<div></div>").append(a),i[e].price_html=a.html())}}),n(this).data("product_variations",i))}),n(document.body).trigger("wc_price_based_country_set_product_price",[o]),n(".wcpbc-price").css("visibility",""),n(".wcpbc-price").css("display",""),n(".wcpbc-price").removeClass("loading")},refresh_areas:function(e){n.each(e,function(e,r){var a='.wc-price-based-country-refresh-area[data-id="'+r.id+'"][data-area="'+r.area+'"]',c=n("<div>"+r.content+"</div>").find('.wc-price-based-country-refresh-area[data-area="'+r.area+'"]').html();n(a).html(c).addClass("refreshed")}),n(document.body).trigger("wc_price_based_country_refresh_areas",[e])},refresh_currency_settings:function(e){if("undefined"!=typeof woocommerce_price_slider_params&&"undefined"!=typeof accounting){var r=n(".price_slider_amount #min_price").data("min"),a=n(".price_slider_amount #max_price").data("max");n(".price_slider_amount span.from").html(accounting.formatMoney(r,{symbol:e.symbol,decimal:e.decimal_sep,thousand:e.thousand_sep,precision:woocommerce_price_slider_params.currency_format_num_decimals,format:e.format})),n(".price_slider_amount span.to").html(accounting.formatMoney(a,{symbol:e.symbol,decimal:e.decimal_sep,thousand:e.thousand_sep,precision:woocommerce_price_slider_params.currency_format_num_decimals,format:e.format})),woocommerce_price_slider_params.currency_format_symbol=e.symbol,woocommerce_price_slider_params.currency_format_decimal_sep=e.decimal_sep,woocommerce_price_slider_params.currency_format_thousand_sep=e.thousand_sep,woocommerce_price_slider_params.currency_format=e.format}n(document.body).trigger("wc_price_based_country_set_currency_params",[e])},compatibility:{variation_price_html:function(e,r,a){return e.length<=0&&r.hasClass("wvs-archive-variation-wrapper")&&(e=n("<span></span>").append(a)),e},bind:function(){0<n(".shop-container .products").length&&n(".shop-container .products").on("append.infiniteScroll",s.geolocate_customer),0<n(".wc-price-based-country-refresh-area .wcsatt-options-wrapper").length&&(n(".wc-price-based-country-refresh-area .wcsatt-options-wrapper").each(function(){var e=n(this).closest(".wc-price-based-country-refresh-area").data("id");n(this).addClass("wcpbc-refresh-flag wcpbc-refresh-flag-"+e)}),n(document.body).on("wc_price_based_country_refresh_areas",function(){n(".wcsatt-options-wrapper.wcpbc-refresh-flag").length&&n(".wc-price-based-country-refresh-area .wcsatt-options-wrapper").each(function(){var e=n(this).closest(".wc-price-based-country-refresh-area").data("id"),r=n(this).closest(".wc-price-based-country-refresh-area").html();n(".wcsatt-options-wrapper.wcpbc-refresh-flag-"+e).replaceWith(r),n(this).remove()}),n(".product form.cart").each(function(){n(this).data("satt_script",null)}),n(document.body).triggerHandler("wcsatt-initialize")})),0<n(".variations_form.cart").length&&0<n('[class^="wcsatt"]').length&&n(document.body).on("wc_price_based_country_set_product_price",function(){0<n(".variations_form.cart .wcsatt-options-wrapper").length&&n(".variations_form.cart .variations select").trigger("change.wc-variation-form")}),0<n(".facetwp-template").length&&document.addEventListener("facetwp-loaded",function(){s.xhr||n(document.body).trigger("wc_price_based_country_ajax_geolocation")}),n(document).on("pjax:end",function(e,r){void 0!==r.responseText&&0<r.responseText.indexOf("wcpbc-price")&&0==n("body").find(".wcpbc-price.loading").length&&setTimeout(function(){0<n(".wcpbc-price.loading").length&&!s.xhr&&n(document.body).trigger("wc_price_based_country_ajax_geolocation")},wc_price_based_country_ajax_geo_params.pjax_timeout)}),n(".skeleton-loading").length&&n(".skeleton-loading").on("skeleton-loaded",function(){n(document.body).trigger("wc_price_based_country_ajax_geolocation")})}},geolocate_customer:function(){s.xhr&&s.xhr.abort();var e={ids:s.get_product_ids(),areas:s.get_areas(),is_single:n("body").hasClass("single")?"1":"0"};0===e.ids.length&&n.isEmptyObject(e.areas)&&0===n(".wcpbc-content:not(.refreshed)").length||(s.xhr=n.ajax({url:wc_price_based_country_ajax_geo_params.wc_ajax_url.toString().replace("%%endpoint%%","wcpbc_get_location"),data:e,type:"POST",success:function(e){s.refresh_product_price(e.products),s.refresh_areas(e.areas),s.refresh_currency_settings(e.currency_params),n(document.body).trigger("wc_price_based_country_after_ajax_geolocation",[e.zone_id])},error:function(e,r){"abort"!==r&&(n(".wcpbc-price").css("visibility",""),n(".wcpbc-price").css("display",""),n(".wcpbc-price").removeClass("loading"))},complete:function(){s.xhr=!1}}))},init:function(){this.geolocate_customer(),n(document).ajaxComplete(function(e,r,a){0<a.url.indexOf("wcpbc_get_location")||0<a.url.indexOf("get_refreshed_fragments")||void 0===r.responseText||r.responseText.indexOf("wcpbc-price")<0||0<n("body").find(".wcpbc-price.loading").length&&s.geolocate_customer()}),n(document.body).on("wc_price_based_country_ajax_geolocation",s.geolocate_customer),this.compatibility.bind()}};s.init()}(jQuery);